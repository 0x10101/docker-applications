version: '2'

services:

 docker-ui:
  image: uifd/ui-for-docker
  restart: always
  privileged: true
#  ports:
#   - 9000:9000
  volumes:
   - /var/run/docker.sock:/var/run/docker.sock
  networks:
   mynet:
    ipv4_address: 172.25.0.2

 rabbitmq:
  image: marcelmaatkamp/rabbitmq-mqtt-ldap
  restart: always
  hostname: rabbitmq
#  ports:
#   - 15672:15672
  environment:
    RABBITMQ_NODENAME: rabbitmq@rabbitmq
  volumes:
   - ./volumes/rabbitmq/mnesia:/var/lib/rabbitmq/mnesia
  networks:
   mynet:
    ipv4_address: 172.25.0.3

 mysql:
  image: mysql
  restart: always
  hostname: mysql
  environment:
   - MYSQL_ROOT_PASSWORD=my-secret-pw
  volumes:
   - ./volumes/mysql:/var/lib/mysql/
   - ./mysql:/docker-entrypoint-initdb.d/
  networks:
   mynet:
    ipv4_address: 172.25.0.4

 nodered:
  build: raptor-node-red
  restart: always
  hostname: nodered
  depends_on:
   - rabbitmq
   - mysql
  links:
   - rabbitmq:rabbitmq
   - mysql:mysql
  ports:
   - 1880:1880
  volumes:
   - ./volumes/nodered:/node-red-data/
  networks:
   mynet:
    ipv4_address: 172.25.0.5

 phpmyadmin:
  image: phpmyadmin/phpmyadmin
  restart: always
  hostname: phpmyadmin
# ports:
#  - 8080:80
  depends_on:
   - mysql
  links:
   - mysql:db
  volumes:
   - ./volumes/phpmyadmin:/sessions
  networks:
   mynet:
    ipv4_address: 172.25.0.6

 phreeze:
  image: marcelmaatkamp/phreeze
  links:
   - mysql:mysql
  depends_on:
   - mysql
  volumes:
   - ./volumes/phreeze/showcase:/var/www/html/showcase
#  ports:
#   - 80:80
  networks:
   mynet:
    ipv4_address: 172.25.0.7

 backend:
  build: backend-nodejs
  hostname: backend
  depends_on:
   - rabbitmq
   - mysql
  links:
   - rabbitmq:rabbitmq
   - mysql:mysql
  # ports:
  #  - 5858:5858 # debug port
  volumes:
   - ./backend-nodejs:/src
  environment:
  # What kind of environment:
  # DEVELOP=0 # autostart processMessages
   - DEVELOP=0 # keep docker image alive for development environment
  #  Alle environment variabelen met hun default waarden
  # graylog2 logging
  # - SHOWCASE_GRAYLOG=0
  # - SHOWCASE_GRAYLOG_HOST=graylog
  # - SHOWCASE_GRAYLOG_PORT=12201
  # - SHOWCASE_GRAYLOG_LEVEL=debug
  # console logging
  # - SHOWCASE_LOG_LEVEL=info
  # - SHOWCASE_LOG_META=0
  # mysql server settings
  # - SHOWCASE_MYSQL_HOST=mysql
  # - SHOWCASE_MYSQL_USER=root
  # - SHOWCASE_MYSQL_PASSWORD=my-secret-pw
  # - SHOWCASE_MYSQL_DATABASE=SHOWCASE_GRAYLOG
  # TTN mqtt settings
  # - SHOWCASE_MQTT_SERVER=staging.thethingsnetwork.org
  # - SHOWCASE_MQTT_PORT=1883
   - SHOWCASE_MQTT_USER=${SHOWCASE_TTN_USERNAME_ACC}
   - SHOWCASE_MQTT_PASSWORD=${SHOWCASE_TTN_PASSWORD_ACC}
  # RabbitMQ amqp settings
  # - SHOWCASE_AMQP_SERVER=rabbitmq
  # - SHOWCASE_AMQP_PORT=5672
  # - SHOWCASE_AMQP_USER=guest
  # - SHOWCASE_AMQP_PASSWORD=guest
  # - SHOWCASE_AMQP_QUEUE_SUFFIX=nodejs_queue_
  # RabbitMQ default message processing in and out settings
  # - SHOWCASE_AMQP_TTN_EXCHANGE_OUT=showcase.ttn_message
  # - SHOWCASE_AMQP_KPN_EXCHANGE_IN=showcase.kpn_message
  # - SHOWCASE_AMQP_KPN_EXCHANGE_OUT # defaults to SHOWCASE_AMQP_TTN_EXCHANGE_OUT value
  # - SHOWCASE_AMQP_DECODE_EXCHANGE_IN # defaults to SHOWCASE_AMQP_TTN_EXCHANGE_OUT value
  # - SHOWCASE_AMQP_DECODE_EXCHANGE_OUT=showcase.observation
  # - SHOWCASE_AMQP_OBSERVATION_LOG_EXCHANGE_IN # defaults to SHOWCASE_AMQP_DECODE_EXCHANGE_OUT value
  # - SHOWCASE_AMQP_OBSERVATION_LOG_EXCHANGE_OUT=showcase.logged_observation
  # - SHOWCASE_AMQP_ALERT_EXCHANGE_IN # defaults to SHOWCASE_AMQP_OBSERVATION_LOG_EXCHANGE_OUT value
  # - SHOWCASE_AMQP_ALERT_EXCHANGE_OUT=showcase.alert"
  # - SHOWCASE_AMQP_ALERT_LOG_EXCHANGE_IN # defaults SHOWCASE_AMQP_ALERT_EXCHANGE_OUT
  # - SHOWCASE_AMQP_ALERT_LOG_EXCHANGE_OUT=showcase.notification
  # - SHOWCASE_AMQP_NOTIFICATION_EXCHANGE_IN # defaults to SHOWCASE_AMQP_ALERT_LOG_EXCHANGE_OUT value
  # - SHOWCASE_AMQP_NOTIFICATION_EXCHANGE_OUT=showcase.logged_notification
  # - SHOWCASE_AMQP_SLACK_EXCHANGE_IN # defaults to SHOWCASE_AMQP_NOTIFICATION_EXCHANGE_OUT value
  # - SHOWCASE_AMQP_SLACK_EXCHANGE_OUT=showcase.notification_sent_slack
  # - SHOWCASE_AMQP_TELKEGRAM_EXCHANGE_IN # defaults to SHOWCASE_AMQP_NOTIFICATION_EXCHANGE_OUT value
  # - SHOWCASE_AMQP_TELEGRAM_EXCHANGE_OUT=showcase.notification_sent_telegram
  # Slack settings
  # - SHOWCASE_SLACK_HOOK_URL=https://hooks.slack.com/services/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
  # Telegram settings
  # - SHOWCASE_TELEGRAM_TOKEN=292441232:AAHS3zE8dyJWRUCx29bLx-MOwWEpimRt0mk
  # - SHOWCASE_TELEGRAM_CHAT_ID=-1001097331998 # default chatid, if no chatid is defined in parameter p1

networks:
 mynet:
  driver: bridge
  ipam:
   config:
    - subnet: 172.25.0.0/24

volumes:
 nexus3:
